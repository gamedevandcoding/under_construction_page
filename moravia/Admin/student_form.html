<!DOCTYPE html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href='admin.css' rel='stylesheet' media="screen">
        <title>Archivio Didattico - Admin</title>
    </head>

    <body>

        <div class="main_container">
            <div class="section_container" style="width: 100%;">

                <section class="section" id="student_form" style="height: 100%; background-color: transparent;">
                    <div class="form_container">
                        <div class="student_message" id="student_output">
                            <svg class="student_message__icon" id="student_icon__done" viewBox="0 0 75 75"><path d="M0 0v75h75V0zm35.534 51.236-4.154 4.155-4.155-4.155-15.232-15.231 4.155-4.155L31.38 47.082 58.852 19.61l4.154 4.154z"/></svg>
                            <svg class="student_message__icon" id="student_icon__warn"viewBox="0 0 86.603 75"><path d="m-3630.64 1211.653-43.301 75h86.602zm3.41 62.45H-3634v-7.023h6.769zm-1.68-11.297h-3.41l-1.933-22.544v-1.78h7.226v1.78z" transform="translate(3673.941 -1211.653)"/></svg>
                            <span class="student_message__span" id="student_span__description">DATI INVALIDI</span>
                        </div>
                        <input type="text" class="student_element" id="student_name" placeholder="Nome">
                        <input type="text" class="student_element" id="student_surname" placeholder="Cognome">
                        <input type="text" class="student_element" id="student_age" placeholder="EtÃ ">
                        <select name="school" class="student_element" id="student_school">
                            <option value="" disabled selected hidden>Scuola</option>
                            <option value="SM">Scuola Media</option>
                            <option value="LC">Liceo Classico</option>
                            <option value="LS">Liceo Scientifico</option>
                            <option value="LSU">Liceo Scienze Umane</option>
                            <option value="ITI">Istituto Tecnico Informatico</option>
                            <option value="ITC">Istituto Tecnico Commerciale</option>
                            <option value="ITG">Istituto Tecnico per Geometri</option>
                            <option value="IPA">Istituto Alberghiero</option>
                        </select>
                        <select name="authorization" class="student_element" id="student_authorization">
                            <option value="" disabled selected hidden>Autorizzazione</option>
                            <option value="bn">Biennio</option>
                            <option value="tr">Triennio</option>
                            <option value="tt">Tutto</option>
                        </select>
                        <button class="student_element" onclick="create_unicode()" id="student_submit">CONFERMA ISCRIZIONE</button>
                        <button class="student_element" onclick="clear_fields()" id="student_clean">NUOVA ISCRIZIONE</button>
                        <label class="student_element" id="student_unicode_label">Codive Univoco</label>
                        <span class="student_element" id="student_unicode">XXXXXXXXX</span>
                        
                        <button class="student_element button_copy" onclick="copy_clipboard()">
                            <svg class="button_copy__svg" viewBox="0 0 60.938 75"><path d="M14.063 0H9.375v9.375H0V75h51.563v-9.375h9.374V0zm32.812 70.313H4.687v-56.25h42.188zm9.375-9.376h-4.688V9.376h-37.5V4.687H56.25z"/></svg>
                            <span class="button_copy__span">Copia</span>
                        </button>
                    </div>
                </section>

            </div>
        </div>


        <script>

            const student_output = document.getElementById('student_output');
            const student_done = document.getElementById('student_icon__done');
            const student_warn = document.getElementById('student_icon__warn');
            const student_span = document.getElementById('student_span__description');

            const studentName = document.getElementById('student_name');
            const studentSurname = document.getElementById('student_surname');
            const studentAge = document.getElementById('student_age');
            const studentSchool = document.getElementById("student_school");
            const studentAuthoriz = document.getElementById("student_authorization");

            const studentUnicode = document.getElementById("student_unicode");

            function student_added(){ student_output.style.backgroundColor = "#00c90f";  student_done.style.display = "block"; student_warn.style.display = "none"; student_span.innerText = "STUDENTE AGGIUNTO"; student_output.style.visibility = "visible";}
            function student_error(){ student_output.style.backgroundColor = "#ff0000"; student_done.style.display = "none"; student_warn.style.display = "block"; }
            function create_unicode(){
                try{
                    var unicode = "";
                    
                    let currentDate = new Date();
                    let isAllString = /\d/;  
                    let isAllNumber = /^\d+$/;

                    studentName.value = studentName.value.replace(/\s/g, '');
                    studentSurname.value = studentSurname.value.replace(/\s/g, '');
                    studentAge.value = studentAge.value.replace(/\s/g, '');
                    
                    if(studentName.value.length > 0 && studentSurname.value.length > 0 && studentAge.value.length > 0 && studentSchool.value.length > 0 && studentAuthoriz.value.length > 0){
                        if(isAllString.test(studentName.value) != true && isAllString.test(studentSurname.value) != true && isAllNumber.test(studentAge.value) != false){
                            unicode = 
                                currentDate.getDate().toString() + (currentDate.getMonth()+1).toString() + 
                                studentName.value.charAt(0).toUpperCase().toString() + studentName.value.charAt(parseInt((studentName.value.length - 1) / 2)).toUpperCase().toString() + studentName.value.charAt(studentName.value.length -1 ).toUpperCase().toString() +
                                studentSurname.value.charAt(0).toUpperCase().toString() + studentSurname.value.charAt(parseInt((studentSurname.value.length - 1) / 2)).toUpperCase().toString() + studentSurname.value.charAt(studentSurname.value.length -1 ).toUpperCase().toString() +
                                studentAge.value.toString() +
                                studentSchool.value.toString() + studentAuthoriz.value.toString() + 
                                currentDate.getHours().toString() + currentDate.getMinutes().toString() + currentDate.getSeconds().toString() + currentDate.getMilliseconds().toString().substring(0,3);
                                
                                studentUnicode.innerText = unicode;
                                studentUnicode.classList.add("selection_active");

                            student_added();
                        }
                        else{ student_error(); student_span.innerText = "CARATTERI ERRATI"; student_output.style.visibility = "visible"; }
                    }
                    else{ student_error(); student_span.innerText = "CAMPI VUOTI"; student_output.style.visibility = "visible"; }
                }
                catch(error){ student_error(); student_span.innerText = "ERRORE"; student_output.style.visibility = "visible"; }
            }
            function clear_fields(){

                student_output.style.visibility = "hidden";
                studentName.value = "";
                studentSurname.value = "";
                studentAge.value = "";
                studentSchool.selectedIndex = "0";
                studentAuthoriz.selectedIndex = "0";
                studentUnicode.innerText = "XXXXXXXXX";
                navigator.clipboard.writeText("null");
            }   
            function copy_clipboard(){ navigator.clipboard.writeText(studentUnicode.textContent); }

            studentSchool.addEventListener("change", function() {
                if(studentSchool.value != ""){ studentSchool.style.color = "#000000"; }
                else{ studentSchool.style.color = "#757575"; }
            });
            studentAuthoriz.addEventListener("change", function() {
                if(studentAuthoriz.value != ""){ studentAuthoriz.style.color = "#000000"; }
                else{ studentAuthoriz.style.color = "#757575"; }
            });

        </script>
    </body>
</html>